# NWEA MAP

## createRoster.js

### Overview

This script creates rosters for the entire district which can then be uploaded to the [NWEA MAP site](http://teach.mapnwea.org). All rosters are created in the rosters directory with a time stamp (ms since epoch). The following rosters are created:

* roster-\<time stamp\>.csv - A "combined roster" that lists all students in their classes.
* roster-update-\<time stamp\>.csv - Same format as above, but only the new lines from the previous version to this version are listed.
* additionalUsers-\<time stamp\>.csv - An "additional users" roster that lists all teachers in the combined roster (unique by teacher ID and building) to turn on proctor privelages.
* additionalUsers-update-\<time stamp\>.csv - Same format as above, but only the new lines from the previous version to this version are listed.

### Methodology

The method of creating the rosters differs depending on the grade level:

#### K-3

These students do not have schedules in [Genesis](http://genesis.monroe.k12.nj.us). They are rostered by the homeroom teacher found in [Genesis](http://genesis.monroe.k12.nj.us) (Code: homeroomTeacherId Table: Student). The teacher's full name is used as the class name. If the ID is a half day kindergarten teacher an AM or PM suffix is added to the class name and the teacher's actual ID is used. If the homeroom teacher ID is a shared teacher the student is rostered under the same class name for each teacher, using their actual teacher ID.

#### 4-8

These students have schedules and [Genesis](http://genesis.monroe.k12.nj.us) and as such students are rostered by their ELA and Math classes. The following classes are rostered:

```javascript
var classes = {
  AMS: [
    "105", //Accelerated Math
    "110", //Algebra I
    "111", //Accelerated Algebra I
    "120", //Geometry
    "160", //Mathematics - Sixth Grade
    "170", //Mathematics - Seventh Grade
    "180", //Mathematics - Eight Grade
    "260", //Language Arts - Sixth Grade
    "270", //Language Arts - Seventh Grade
    "280"  //Language Arts - Eight Grade
  ],
  AES: [
    "140", //Mathematics
    "150", //Mathematics
    "159", //Accelerated Math
    "201", //Wilson Reading
    "240", //English Language Arts
    "250", //English Language Arts
  ],
  BES: [
    "140", //Mathematics
    "150", //Mathematics
    "159", //Accelerated Math
    "240", //English Language Arts
    "250", //English Language Arts
  ],
  WES: [
    "140", //Mathematics
    "150", //Mathematics
    "159", //Accelerated Math
    "240", //English Language Arts
    "250", //English Language Arts
  ]
};
```

Each class has a courseid associated with it which is looked up from the GradebookTeacherSection table in [Genesis](http://genesis.monroe.k12.nj.us). When rostering, a hash table is used to store teachers and students in courses with the same courseid. The roster is then generated by creating a line for each student under each teacher. This has the effect of creating the same list of all students for both teachers of a co-taught class where the class gradebook has been merged in [Genesis](http://genesis.monroe.k12.nj.us). Class names follow the format of \<Period\> \<Course Description\> (\<courseid\>). The courseid is included to make the name unique for the individual teacher as some teachers teach multiple classes at the same time in different rooms in Genesis.

### Warnings

There are some sanity checks performed and the script will output non-fatal warnings.

* If a student cannot be looked up in the Genesis reports it often means they are still scheduled but have left the district.
* If a teacher cannot be looked up in the Genesis reports it often means they are no longer in district but still listed in student schedules.
* If a student is in more than four classes (two teachers in ELA and Math) it often means their schedule has been changed but they haven't been removed from their old classes.
* If a class has over 35 students in it, it often means that two classes were incorrectly merged.
* If an email can't be created for a student it often means their networkID is not in Genesis.
